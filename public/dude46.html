
<!DOCTYPE html>
<head>
    <title>WebRTC Simple Calling API + Mobile</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="css/pubnub.css" rel="stylesheet" type="text/css">
     <link rel="stylesheet" type="text/css" href="./css/control_utils.css">
    <script src="./javascript/camera_utils.js"></script>
    <script src="./javascript/control_utils.js"></script>
    <script src="./javascript/drawing_utils.js"></script>
     <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="./javascript/pose.js"></script>
    <style>
        .overlay {
    height: 100%;
    width: 100%;
    position: fixed;
    z-index: 10000;
    top: 0;
    left: 0;
    background-color: rgb(0, 0, 0);
    background-color: rgba(0, 0, 0, 0.9);
    overflow-x: hidden;
    transition: 0.5s;
}.overlay .closebtn {
    position: absolute;
    top: 20px;
    right: 45px;
    font-size: 60px;
}

.overlay a {
    padding: 8px;
    text-decoration: none;
    font-size: 36px;
    color: #818181;
    display: block;
    transition: 0.3s;
}
      #container {
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            display: flex; /* Use flexbox for alignment */
            flex-direction: column; /* Stack elements vertically */
            justify-content: center; /* Center elements vertically */
            align-items: center; /* Center elements horizontally */
        }

        video {
            max-width: 100%; /* Make video responsive */
            height: auto; /* Maintain aspect ratio */
        }

        canvas {
            margin: 10px 0; /* Optional: Add some space between video and canvas */
        }
    </style>
    <script>


const counter2 = 0;


var MyApp = {}; // Globally scoped object
   
function openNav() {
    document.getElementById("myNav").style.width = "100%";
  }

  /* Close when someone clicks on the "x" symbol inside the overlay */
  function closeNav() {
    document.getElementById("myNav").style.width = "0%";
  }

  let provider;
        let walletAddress = '';

        // Detect the Phantom provider
        function getProvider() {
            if ("solana" in window) {
                const provider = window.solana;
                if (provider.isPhantom) {
                    return provider;
                }
            }
            window.open("https://phantom.app/", "_blank");
        }

        // Update wallet status on the frontend
        function updateWalletStatus() {
            if (walletAddress) {
                document.getElementById('wallet-status').innerText = 'Wallet connected!';
                document.getElementById('wallet-address').innerText = `Wallet Address: ${walletAddress}`;
                document.getElementById('connect-button').style.display = 'none';
                document.getElementById('disconnect-button').style.display = 'block';
                document.getElementById('create-user-button').style.display = 'block';
            } else {
                document.getElementById('wallet-status').innerText = 'Not connected';
                document.getElementById('wallet-address').innerText = '';
                document.getElementById('connect-button').style.display = 'block';
                document.getElementById('disconnect-button').style.display = 'none';
                document.getElementById('create-user-button').style.display = 'none';
            }
        }

        // Connect to Phantom Wallet
        document.getElementById('connect-button').addEventListener('click', async () => {
            provider = getProvider();

            if (provider) {
                try {
                    await provider.connect();
                    walletAddress = provider.publicKey?.toString();
                    updateWalletStatus();
                } catch (err) {
                    console.error("Wallet connection failed:", err);
                }
            } else {
                console.error("Phantom provider not found.");
            }
        });

        // Disconnect from Phantom Wallet
        document.getElementById('disconnect-button').addEventListener('click', async () => {
            if (provider) {
                try {
                    await provider.disconnect();
                    walletAddress = '';
                    updateWalletStatus();
                    console.log("Wallet disconnected");
                } catch (err) {
                    console.error("Wallet disconnection failed:", err);
                }
            }
        });

        // Auto-connect if Phantom is already connected
        window.onload = async () => {
            provider = getProvider();

            if (provider) {
                // Try to auto-connect on load
                await provider.connect({ onlyIfTrusted: true });
                walletAddress = provider.publicKey?.toString();
                updateWalletStatus();
            }
        };

        // Create user account on Solana (optional button functionality)
        document.getElementById('create-user-button').addEventListener('click', async () => {
            // Create user account logic (you can place your Solana transaction code here)
        });
   
    </script>
</head>
<body>

    <div id="myNav" class="overlay">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
        <div id="onctent2" class="overlay-content">
      <!--      <a href="#">About</a>
          <a href="#">Services</a>
          <a href="#">Clients</a>
          <a href="#">Contact</a>-->
         <h1> Waiting for Player</h1>
             <h1>Login with Google</h1>
        <button id="connect-button">Connect to Phantom Wallet</button>
          <p id="wallet-status">Not connected</p>
          <p id="wallet-address"></p>
          <button id="create-user-button" style="display:none;">Create User Account</button>
      
          <!-- The Google Sign-In button -->
          <div id="g_id_onload"
               data-client_id="403728753981-6idn5rhiloi9bvrr5vga2c9li42ui9b8.apps.googleusercontent.com"
               data-callback="handleCredentialResponse">
          </div>
      
          <div class="g_id_signin" 
               data-type="standard"
               data-size="large"
               data-theme="outline"
               data-text="sign_in_with"
               data-shape="rectangular"
               data-logo_alignment="left">
          </div>
         <button id="sendButton" onclick="timer3();closeNav();">Start demo</button>
      
      
        </div>
        <div id="onctent5"></div>
      </div>
<!-- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= -->
<!-- My Phone Number & Dial Areas -->
<!-- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= -->
<div>
    <div class="form-container">
        <script>

let player;
        if (player === player1) {
            // Handle the case when player is player1
            var element = document.getElementById("bet1");
            if (element) {
                element.style.display = "block"; // Change display to block
            }
        } else {
            // Handle the case when player is not player1
            showForm2();
        }
        
        
        </script>
        
                <h2>Place Your Bet</h2>
                <div style="display: none;" id="yesno">
                    <span id="west55"></span>
                    <span style="display: none;" id="west56"></span>
                  <button id="56t" onclick="sendMessage1()">yes</button><button>no</button>  
                </div>
                <div style="display: none;" id="bet1">
                    <!-- Bet Amount Slider -->
                    <label for="betAmount">Bet Amount (£):</label>
                    <div class="slider-container">
                        <input type="range" id="betAmount" name="betAmount" min="1" max="200" value="1" oninput="updateBetAmount(this.value)">
                        <span class="slider-output" id="betAmountOutput">£1</span>
                    </div>
            
                    <!-- Additional Fields -->
                    <label for="username">Your Name:</label>
                    <input type="text" id="username" name="username" required>
            
                    <label for="gameChoice">Game Choice:</label>
                 
            
                    <!-- Submit Button -->
                    <button onclick="sendMessage()" id="button1" type="submit">Place Bet</button>
                </div>
            </div>
    <div class="row" style="    width: 100%; /* Full width */
    height: 100%; /* Full height */
    display: flex; /* Use flexbox for alignment */
    flex-direction: column; /* Stack elements vertically */
    justify-content: center; /* Center elements vertically */
    align-items: center;">

        <!-- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= -->
        <!-- MY PHONE NUMBER -->
        <!-- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= -->

        
          
              <video class="input_video" style="display: none;"></video>
              <canvas class="output_canvas" width="400px" height="300px"></canvas>
              <!-- <canvas class="counter_canvas" width="200px" height="720px"></canvas> -->
              <div class="loading">
                  <div class="spinner"></div>
                  <div class="message">
                    
                  
              </div>
              <a class="abs logo" href="https://github.com/baoanh1310/pose_demo" target="_blank">
                  <div style="display: flex;align-items: center;bottom: 0;right: 10px;">
                      <img class="logo" src="logo_white.png" alt="" style="
                height: 50px;">
                     
                  </div>
              </a>
             
          </div>
          <div class="control-panel" style="display: none;">
          </div>
          <div id="angle1"></div>
          <div id="stage1">0</div>
          <div id="counter1">0</div>
         

        <div style="display: none;" class="col-sm-6">
            <video class="input_video selfie" ></video>
            <canvas class="output_canvas" width="400px" height="300px"></canvas>
            <div style="display: none;" id="my-number-section" class="text-center">
                <div id="my-number">LOADING</div>
                <div id="my-number-title" class="hidden-sm hidden-xs">
                    this is <strong>your phone number</strong>
                </div>
                <div id="my-number-permalink">
                    <span class="glyphicon glyphicon-link"></span>
                    call link:
                    <a id="my-number-link" href="..." target="_blank">https://...</a>
                </div>
            </div>
            <div id="pubnub-chat-section" style="display: none;" class="text-center">
                <input id="pubnub-chat-input" type="text" placeholder="chat here">
                <div id="pubnub-chat-output"><div></div></div>
            </div>
        </div>

        <!-- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= -->
        <!-- Video -->
        <!-- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= -->
        <div class="col-sm-6">
            <!-- DISPLAY -->
            <div class="row">
                <div class="col-xs-12 text-center">
                    <div id="video-border">
                        <div class="pubnub-relative">
                            <div id="video-self"></div>
                        </div>
                        <div id="video-display">
                            <span class="glyphicon glyphicon-flash"></span>
                        </div>
                    </div>
                    <div id="pubnub-relative">
                        <div id="video-thumbnail"></div>
                        <div id="pubnub-logo">
                            <div id="pubnub-logo-img"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- DIAL CONTROLS -->
            <div style="display: none;" class="row">
                <div class="col-sm-6 col-xs-7">
                    <div class="form-group"><div class="input-group">
                    <div class="input-group-addon">
                        <span class="glyphicon glyphicon-th"></span>
                    </div>
                    <input id="number" class="form-control" type="number" placeholder="Type Recipient's #">
                    </div></div>
                </div>
                <div class="col-sm-6 col-xs-5 dial-buttons">
                    <button id="dial" class="btn btn-primary">
                        <span class="glyphicon glyphicon-earphone"></span>
                    </button>
                    <button id="snap" class="btn btn-success">
                        <span class="glyphicon glyphicon-camera"></span>
                    </button>
                    <button id="hangup" class="btn btn-danger">
                        <span class="glyphicon glyphicon-ban-circle"></span>
                    </button>                    
                </div>
            </div>
        </div>
    </div>
</div>

<!-- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=- -->
<!-- WebRTC Peer Connections -->
<!-- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=- -->
<!-- IMPORTANT: THIS IS AN UNMINIFIED DEVELOPMENT PUBNUB LIBRARY 
    replace this with the latest versioned, minified CDN lib link before 
    you deploy your app to a production enviornment.
    https://github.com/pubnub/javascript#cdn-links
-->
<script src="https://cdn.pubnub.com/pubnub.js"></script>

<!-- WebRTC SDK -->
<script src="js/webrtc.js"></script>
<script src="js/sound.js"></script>
<script>


if (player === player1) {
    // Handle the case when player is player1
    var element = document.getElementById("bet1");
    if (element) {
        element.style.display = "block"; // Change display to block
    }
} else {
    // Handle the case when player is not player1
    showForm2();
}


(function(){

// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// Generate Random Number if Needed
let updateBetAmount = 0;
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
let beton;
var urlargs         = urlparams();
var my_number       = PUBNUB.$('my-number');
var my_link         = PUBNUB.$('my-number-link');
var number          = urlargs.number || Math.floor(Math.random()*999+1);

my_number.number    = number;
my_number.innerHTML = ''+my_number.number;
my_link.href        = location.href.split('?')[0] + '?call=' + number;
my_link.innerHTML   = my_link.href;

// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// Update Location if Not Set
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
if (!('number' in urlargs)) {
    urlargs.number = my_number.number;
    location.href = urlstring(urlargs);
    return;
}

// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// Get URL Params
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function urlparams() {
    var params = {};
    if (location.href.indexOf('?') < 0) return params;

    PUBNUB.each(
        location.href.split('?')[1].split('&'),
        function(data) { var d = data.split('='); params[d[0]] = d[1]; }
    );

    return params;
}

// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// Construct URL Param String
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function urlstring(params) {
    return location.href.split('?')[0] + '?' + PUBNUB.map(
        params, function( key, val) { return key + '=' + val }
    ).join('&');
}

// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// Calling & Answering Service
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
var video_out = PUBNUB.$('video-display');
var img_out   = PUBNUB.$('video-thumbnail');
var img_self  = PUBNUB.$('video-self');

var phone     = window.phone = PHONE({
    number        : my_number.number // listen on this line
,   media         : { video: { width:640, height:480 }, audio: true } // <--- Set Camera Resolution
,   publish_key   : 'pub-c-561a7378-fa06-4c50-a331-5c0056d0163c'
,   subscribe_key : 'sub-c-17b7db8a-3915-11e4-9868-02ee2ddab7fe'
,   secure        : true, ssl: true
});

// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// Video Session Connected
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function connected(session) {
    video_out.innerHTML = '';
    video_out.appendChild(session.video);

    PUBNUB.$('number').value = ''+session.number;
    sounds.play('sound/hi');
    console.log("Hi!");

    if (session.connected) {
       // alert("Session is connected!");
        timer3();closeNav();

       
if (call == null || call.length < 1) {
    player = player1;
} else {
    player = player2;
}
// ... existing code ...

// ... existing code ...
    }

   
}

// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// Video Session Ended
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function ended(session) {
    clearInterval(thumbnail.ival);
    thumbnail.ival = 0;
    set_icon('facetime-video');
    img_out.innerHTML = '';
    sounds.play('sound/goodbye');
    console.log("Bye!");
}

// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// Video Session Ended
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function set_icon(icon) {
    video_out.innerHTML = '<span class="glyphicon glyphicon-' +
        icon + '"></span>';
}

// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// Start Phone Call
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function dial(number) {
    // Hangup an old call
    phone.hangup();

    // Dial Number
    var session = phone.dial(number);

    // No Dupelicate Dialing Allowed
    if (!session) return;

    // Show Connecting Status
    set_icon('send');
}

// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// Ready to Send or Receive Calls
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
phone.ready(function(){
    // Ready To Call
    set_icon('facetime-video');

    // Auto Call


    if('number' in urlargs){
        var dickhead = urlargs['number'];
        const elem = document.getElementById("onctent5");   if (elem) {
                elem.innerHTML = `<div class="copy-link">
  <input type="text" class="copy-link-input" value="https://fitclash.vercel.app/?call=`+dickhead+`" readonly>
  <button type="button" class="copy-link-button">
    <span class="material-icons">content_copy</span>
  </button>
</div>`+ dickhead;
                console.log('you 8'+ dickhead);


                document.querySelectorAll(".copy-link").forEach(copyLinkParent => {
  const inputField = copyLinkParent.querySelector(".copy-link-input");
  const copyButton = copyLinkParent.querySelector(".copy-link-button");
  const text = inputField.value;

  inputField.addEventListener("focus", () => inputField.select());

  copyButton.addEventListener("click", () => {
    inputField.select();
    navigator.clipboard.writeText(text);

    inputField.value = "Copied!";
    setTimeout(() => inputField.value = text, 2000);
  });
});


            } else {
                console.log('you 7');
            }
        console.log(dickhead+ 'fuck you');
    }


    if ('call' in urlargs) {
        var number = urlargs['call'];
        PUBNUB.$('number').value = number;
        dial(number);
        
        var player = "player2";
console.log("you are player 2")
var element1 = document.getElementById("yesno");
    if (element1) {
        element1.style.display = "block"; // Change display to block
        element1.style.display = "block"; // Change display to block
        element1.style.position = "fixed"; // Position fixed to center it
        element1.style.top = "50%"; // Center vertically
        element1.style.left = "50%"; // Center horizontally
        element1.style.transform = "translate(-50%, -50%)"; // Adjust for element size
        element1.style.zIndex = "1000"; // Set z-index to 1000
   
    }
    }else{
        var player = "player1";
        console.log("you are player 1")
        var element = document.getElementById("bet1");
    if (element) {
        element.style.display = "block"; // Change display to block
        element.style.position = "fixed"; // Position fixed to center it
        element.style.top = "50%"; // Center vertically
        element.style.left = "50%"; // Center horizontally
        element.style.transform = "translate(-50%, -50%)"; // Adjust for element size
        element.style.zIndex = "1000"; // Set z-index to 1000

        // Create button1
       
    }
  
    }

    // Make a Phone Call
    PUBNUB.bind( 'mousedown,touchstart', PUBNUB.$('dial'), function(){
        var number = PUBNUB.$('number').value;
        if (!number) return;
        dial(number);
    } );

    // Hanup Call
    PUBNUB.bind( 'mousedown,touchstart', PUBNUB.$('hangup'), function() {
        phone.hangup();
        set_icon('facetime-video');
    } );

    // Take Picture
    PUBNUB.bind( 'mousedown,touchstart', PUBNUB.$('snap'), function() {
        var photo = phone.snap();

        if (!(photo && photo.image))
            return console.error(
                '%c Connect your video with a partner first.',
                'font-size:30px;background:#f00;color:#fff'
            );

        img_self.innerHTML = ' ';
        img_self.appendChild(photo.image);
        setTimeout( function() { img_self.innerHTML = ' ' }, 750 );
    } );
});

// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// Received Call Thumbnail
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function thumbnail(session) {
    img_out.innerHTML = '';
    img_out.appendChild(session.image);
    img_out.appendChild(phone.snap().image);
}

// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// Receiver for Calls
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
phone.receive(function(session){
    session.message(message);
    session.thumbnail(thumbnail);
    session.connected(connected);
    session.ended(ended);

    if (!thumbnail.ival)
        thumbnail.ival = setInterval( () => thumbnail(session), 400 );
});

// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// Chat
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
var chat_in  = PUBNUB.$('pubnub-chat-input');
var chat_out = PUBNUB.$('pubnub-chat-output');

// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// Send Chat MSG and update UI for Sending Messages
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
PUBNUB.bind( 'keydown', chat_in, function(e) {
    if ((e.keyCode || e.charCode) !== 13)     return true;
    if (!chat_in.value.replace( /\s+/g, '' )) return true;

    phone.send({ text : chat_in.value });
    add_chat( my_number.number + " (Me)", chat_in.value );
    chat_in.value = '';
} )

// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// Update Local GUI
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function add_chat( number, text ) {
    if (!text.replace( /\s+/g, '' )) return true;

    var newchat = document.createElement('div');
    var west44 = document.getElementById('west55');
    var code1 = PUBNUB.supplant(safetxt(text));
    console.log("this what i want "+code1+"the bet has been made"+west44.innerHTML);
    
    if (code1.substring(0, 6) === "mycock") {
        west44.innerHTML = code1.slice(6); 
}

if (dude67 = false){
    console.log('your shit dick')
}
if(code1.substring(0, 5) ==="beton") {
    beton = code1.slice(5);
    console.log('updated beton')
}
   
    newchat.innerHTML = PUBNUB.supplant(
        '<strong>{number}: </strong> {message}', {
        message : safetxt(text),
        number  : safetxt(number)
    } );
    chat_out.insertBefore( newchat, chat_out.firstChild );
}

// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// WebRTC Message Callback
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function message( session, message ) {
    add_chat( session.number, message.text );
}

// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// XSS Prevent
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function safetxt(text) {
    return (''+text).replace( /[<>]/g, '' );
}

// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// Problem Occured During Init
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
phone.unable(function(details){
    console.log("Alert! - Reload Page.");
    console.log(details);
    set_icon('remove');
}

);

// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// Debug Output
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
phone.debug(function(details){
    console.log(details);
});

})();</script>

<script>
    // Our input frames will come from here.
   
   
    const videoElement = document.getElementsByClassName('input_video')[0];
    const canvasElement = document.getElementsByClassName('output_canvas')[0];
    const controlsElement = document.getElementsByClassName('control-panel')[0];
    const canvasCtx = canvasElement.getContext('2d');
    
    // const counterElement = document.getElementsByClassName('counter_canvas')[0];
    // const canvasCounter = counterElement.getContext('2d');
    
    // We'll add this to our control panel later, but we'll save it here so we can
    // call tick() each time the graph runs.
    const fpsControl = new FPS();
    
    // Optimization: Turn off animated spinner after its hiding animation is done.
    const spinner = document.querySelector('.loading');
    spinner.ontransitionend = () => {
        spinner.style.display = 'none';
    };
    
    // Curl counter stuff
    let angle = 0.0;
    let stage = "DOWN";
    let counter = 0;
    
    function zColor(data) {
        return 'white';
    }
    
    function calculate_angle(shoulder, elbow, wrist) {
      let radians = Math.atan2(wrist[1]-elbow[1], wrist[0]-elbow[0]) - 
        Math.atan2(shoulder[1]-elbow[1], shoulder[0]-elbow[0]);
      let angle = Math.abs(radians * 180.0 / Math.PI);
    
      if (angle > 180.0) {
        angle = 360 - angle;
      }
    
      return angle;
    }
    
    function onResults(results, value1, value2) {
        // Hide the spinner.
        document.body.classList.add('loaded');
    
        // Update the frame rate.
        fpsControl.tick();
    
        // Draw the overlays.
        canvasCtx.save();
        canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
        canvasCtx.drawImage(
            results.image, 0, 0, canvasElement.width, canvasElement.height);
        drawConnectors(
            canvasCtx, results.poseLandmarks, POSE_CONNECTIONS, {
                visibilityMin: 0.65,
                color: 'white'
            });
        drawLandmarks(
            canvasCtx,
            Object.values(POSE_LANDMARKS_LEFT)
            .map(index => results.poseLandmarks[index]), { visibilityMin: 0.65, color: zColor, fillColor: 'rgb(255,138,0)' });
        drawLandmarks(
            canvasCtx,
            Object.values(POSE_LANDMARKS_RIGHT)
            .map(index => results.poseLandmarks[index]), { visibilityMin: 0.65, color: zColor, fillColor: 'rgb(0,217,231)' });
        drawLandmarks(
            canvasCtx,
            Object.values(POSE_LANDMARKS_NEUTRAL)
            .map(index => results.poseLandmarks[index]), { visibilityMin: 0.65, color: zColor, fillColor: 'white' });
        // canvasCtx.restore();
    
        const landmarksRight = Object.values(POSE_LANDMARKS_LEFT)
          .map(index => results.poseLandmarks[index]);
    
        const shoulder = [landmarksRight[5].x, landmarksRight[5].y];
        const elbow = [landmarksRight[6].x, landmarksRight[6].y];
        const wrist = [landmarksRight[7].x, landmarksRight[7].y];
    
        angle = calculate_angle(shoulder, elbow, wrist);
        
        // console.log(angle);
        if (angle > 140) {
          stage = "DOWN";
        } 
        if (angle < 30 && stage == "DOWN") {
          stage = "UP";
          counter += 1;
        
          // console.log(stage + ", ", counter);
        }
        console.log("Angle: " + angle + ", Stage: " + stage + ", ", counter);
        //document.getElementById('angle1').innerHTML = angle;
        document.getElementById('stage1').innerHTML = stage;
        document.getElementById('counter1').innerHTML = counter;
       value2 = 12;
       // document.getElementById("onctent1").innerHTML = "My Score is" + counter + "<br> The Oppents Score Is" + value2;
        if (counter > value2){
          document.getElementById("onctent5").innerHTML = "you win"
        }else{
          document.getElementById("onctent5").innerHTML = "you lose"
        }
        
        //counter2 = value1;
      
        canvasCtx.font = "30px Arial";
        canvasCtx.fillStyle = "red";
        canvasCtx.fillText(stage + ": " + counter.toString(), 1100, 50);
        canvasCtx.restore();
    }
    
    const pose = new Pose({
        locateFile: (file) => {
            return `https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.3.1621277220/${file}`;
        }
    });
    pose.onResults(onResults);
    
    /**
     * Instantiate a camera. We'll feed each frame we receive into the solution.
     */
    const camera = new Camera(videoElement, {
        onFrame: async () => {
            await pose.send({ image: videoElement });
        },
        width: 400,
        height: 300
    });
    camera.start();
    
    // Present a control panel through which the user can manipulate the solution
    // options.
    new ControlPanel(controlsElement, {
            selfieMode: true,
            modelComplexity: 0,
            smoothLandmarks: true,
            minDetectionConfidence: 0.2,
            minTrackingConfidence: 0.2
        })
        .add([
            new StaticText({ title: 'Curl Counter Mode' }),
            fpsControl,
            new Toggle({ title: 'Right Hand Practice', field: 'selfieMode' }),
            // new Slider({
            //     title: 'Model Complexity',
            //     field: 'modelComplexity',
            //     discrete: ['Lite', 'Full', 'Heavy'],
            // }),
            // new Toggle({ title: 'Smooth Landmarks', field: 'smoothLandmarks' }),
            // new Slider({
            //     title: 'Min Detection Confidence',
            //     field: 'minDetectionConfidence',
            //     range: [0, 1],
            //     step: 0.01
            // }),
            // new Slider({
            //     title: 'Min Tracking Confidence',
            //     field: 'minTrackingConfidence',
            //     range: [0, 1],
            //     step: 0.01
            // }),
        ])
        .on(options => {
            videoElement.classList.toggle('selfie', options.selfieMode);
            pose.setOptions(options);
        });
        function timer3(){
  
  var timeLeft = 30;
  var elem = document.getElementById('Timer');
  
  
  document.getElementById('onctent2').id = 'onctent1';
  
  var timerId = setInterval(countdown, 1000);
  
  function countdown(counter, results, value1) {
    if (timeLeft == 0) {
      clearTimeout(timerId);
   //   document.getElementById("onctent1").innerHTML = "";
  //value1 = counter;
    
      document.getElementById('onctent1').id = 'two';
      openNav();
     // alert(counter);
      doSomething();
      
    } else {
      elem.innerHTML = timeLeft + ' seconds remaining';
      timeLeft--;
    }
  }
  
  }
  
  /*
  var button45 = document.getElementById("button1");
  button45.onclick = function() {
          sendMessage(); // Call function to send message via PubNub
          console.log("why the shit")
  
      };
  
  */
  
  
  function sendMessage(session, message) {
 
  var red1 = document.getElementById("betAmount");
  phone.send({ text : "mycock"+red1.value });

  console.log("your bet is "+red1.value);

  //console.log("sdfsdf"+message.text)
  
  }

  function sendMessage1(session, message) {
 
 var red1 = document.getElementById("west55");
 var red2 = document.getElementById("west56");
 red2.innerHTML= "your mum";
 phone.send({ text : "beton"+red1.innerHTML });

 console.log("your bet has been confirmed "+red1.innerHTML);

 const dude67 = false;

 console.log(dude67)
 //console.log("sdfsdf"+message.text)
 
 }


    
  function dude33(session, message) {
 
 var red3aa = document.getElementById("betAmount");
 var which = red3aa.value;
 phone.send({ text : "beton"+red3aa.value });

 console.log("bet confirmed at "+ which);

 //console.log("sdfsdf"+message.text)
 
 }
    </script>
    <footer class="mt-auto text-white-50">
        <div id="Timer">0:00</div>
       <!-- <p>Cover template for <a href="https://getbootstrap.com/" class="text-white">Bootstrap</a>, by <a href="https://twitter.com/mdo" class="text-white">@mdo</a>.</p>-->
      </footer>
</body>
</html>
